# Contexto: raiz do monorepo (docker compose context: .)
# Build: docker compose -f docker-compose-dev.yml up --build
FROM node:20-alpine

WORKDIR /app

# 1. Manifests e shared (cache de deps)
COPY package.json package-lock.json ./
COPY backend/package.json ./backend/
COPY frontend/package.json ./frontend/
COPY shared/package.json ./shared/
COPY shared/ ./shared/
COPY tsconfig.base.json ./

# 2. Instala deps do workspace (frontend usa shared)
RUN npm ci

# 3. CÃ³digo do frontend
COPY frontend/ ./frontend/

WORKDIR /app/frontend
CMD ["npm", "run", "dev"]
